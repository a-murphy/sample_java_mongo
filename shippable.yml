language: java

jdk:
  - openjdk8

env:
  - secure: oy0lr4MKViAGDlY9M0XYJLj5EoLUXCgl1nkKL2YrhUmYBLCWVzNiA4P9Bj/NxJbwqXgNloJOS/fEQMtUoKErjS+5gKhtCJjEBS5iZxrbV+TPpywHY2SdfwBR5ySaVKH26Y7vQQurJOdMFQMkDd1Ry4rhPA3OVQrWoltEcpw1wnOyVhN9qM7E0zBiJRyjqQioz/dWEavs7yHy1g5SgaOns3VzpGDlZf9jfO7UcWhElgFNOCbOqA/56+dXxSN4siNd0QqmvE7iNB5UE1m7FRWsjxxdP1EWPL46mIFrrqcUA+61zoVMptGcbM864aeVwjAv3Mt+K6yo1BheURfYLPVaCg==

services:
   - mongodb
build:
  ci:
    - ant clean
  post_ci:
    - apt-get install -y net-tools
    - docker ps
    - echo $DOCKER_HOST
    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock -e DOCKER_HOST dockercloud/client --user $DOCKER_USER --pass $DOCKER_PASSWORD amurphy/swarm1
    #- DOCKER_HOST=$(ifconfig docker0|grep -Po 't addr:\K[\d.]+')
    - echo $DOCKER_HOST
    - DOCKER_HOST=$(docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' client_proxy_amurphy_swarm1)
    - echo $DOCKER_HOST
    - docker ps || true # Running docker ps through the proxy
    - DOCKER_HOST=172.17.42.1
    - echo $DOCKER_HOST
    - docker ps || true # Running docker ps through the proxy
    - unset DOCKER_HOST
    - docker ps # Running 'docker ps' locally
